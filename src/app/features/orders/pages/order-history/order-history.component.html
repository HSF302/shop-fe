<div class="order-history-container">
  <div class="order-history-content">
    <h1>Order History</h1>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="loading">
      <mat-spinner></mat-spinner>
      <p>Loading your orders...</p>
    </div>

    <!-- Error State -->
    <div class="error-container" *ngIf="error && !loading">
      <mat-icon class="error-icon">error</mat-icon>
      <p>{{ error }}</p>
      <button mat-raised-button color="primary" (click)="loadOrders()">
        Try Again
      </button>
    </div>

    <!-- Orders List -->
    <div class="orders-list" *ngIf="!loading && !error">
      <div *ngIf="(orders$ | async) as orders">
        <!-- Empty State -->
        <div class="empty-orders" *ngIf="orders.length === 0">
          <mat-icon class="empty-icon">shopping_bag</mat-icon>
          <h2>No Orders Yet</h2>
          <p>You haven't placed any orders yet. Start shopping to see your order history here.</p>
          <button mat-raised-button color="primary" (click)="goToProducts()">
            <mat-icon>shopping_cart</mat-icon>
            Start Shopping
          </button>
        </div>

        <!-- Orders -->
        <mat-accordion *ngIf="orders.length > 0">
          <mat-expansion-panel 
            *ngFor="let order of orders; trackBy: trackByOrderId"
            class="order-panel">
            
            <mat-expansion-panel-header>
              <mat-panel-title>
                <div class="order-header">
                  <div class="order-info">
                    <span class="order-number">Order #{{ order.id }}</span>
                    <span class="order-date">{{ formatDate(order.orderDate) }}</span>
                  </div>
                  <div class="order-summary">
                    <mat-chip [class]="getStatusClass(order.status)">
                      {{ order.status | titlecase }}
                    </mat-chip>
                    <span class="order-total">{{ formatPrice(order.totalAmount) }}</span>
                  </div>
                </div>
              </mat-panel-title>
            </mat-expansion-panel-header>

            <div class="order-details">
              <!-- Shipping Information -->
              <div class="shipping-info">
                <h3>Shipping Information</h3>
                <p><strong>Address:</strong> {{ order.shippingAddress }}</p>
                <p *ngIf="order.contactInfo">
                  <strong>Contact:</strong> {{ order.contactInfo }}
                </p>
              </div>

              <!-- Order Items -->
              <div class="order-items">
                <h3>Items ({{ order.orderDetails.length }})</h3>
                <div class="items-list">
                  <div class="order-item" *ngFor="let detail of order.orderDetails">
                    <div class="item-image">
                      <img [src]="detail.product?.imageUrl || '/assets/images/placeholder-dress.jpg'" 
                           [alt]="detail.product?.name"
                           (error)="onImageError($event)">
                    </div>
                    <div class="item-details">
                      <h4>{{ detail.product?.name }}</h4>
                      <p class="item-variants">
                        <span *ngIf="detail.size">Size: {{ detail.size }}</span>
                        <span *ngIf="detail.color"> • Color: {{ detail.color }}</span>
                        <span *ngIf="detail.material"> • Material: {{ detail.material }}</span>
                      </p>
                      <p class="item-quantity">Quantity: {{ detail.quantity }}</p>
                    </div>
                    <div class="item-price">
                      <span class="unit-price">{{ formatPrice(detail.unitPrice) }}</span>
                      <span class="total-price">{{ formatPrice(detail.totalPrice) }}</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Order Actions -->
              <div class="order-actions">
                <button mat-button (click)="viewOrderDetails(order.id)">
                  <mat-icon>visibility</mat-icon>
                  View Details
                </button>
                <button mat-button (click)="reorderItems(order)" 
                        *ngIf="order.status !== 'CANCELLED'">
                  <mat-icon>refresh</mat-icon>
                  Reorder
                </button>
              </div>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </div>
    </div>
  </div>
</div>
