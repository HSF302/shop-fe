<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang chủ - Office Dress Shop</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link th:href="@{/css/user-style.css}" rel="stylesheet">
    
    <style>
        /* Custom Navbar Styles */
        .navbar {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0,0,0,0.08) !important;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05) !important;
        }
        
        .navbar-brand {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50 !important;
            transition: all 0.3s ease;
        }
        
        .navbar-brand:hover {
            color: #3498db !important;
            transform: translateY(-1px);
        }
        
        .nav-link {
            font-weight: 500;
            color: #2c3e50 !important;
            padding: 0.75rem 1rem !important;
            border-radius: 8px;
            margin: 0 0.25rem;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .nav-link:hover {
            color: #3498db !important;
            background: rgba(52, 152, 219, 0.1);
            transform: translateY(-1px);
        }
        
        .nav-link.active {
            color: #3498db !important;
            background: rgba(52, 152, 219, 0.15);
            font-weight: 600;
        }
        
        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 3px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-radius: 2px;
        }
        
        .dropdown-toggle::after {
            margin-left: 0.5rem;
        }
        
        .dropdown-menu {
            border: none;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-radius: 12px;
            padding: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .dropdown-item {
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .dropdown-item:hover {
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
            transform: translateX(5px);
        }
        
        .dropdown-item.text-danger:hover {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c !important;
        }
        
        /* Ensure logout button is visible */
        .dropdown-item.text-danger {
            color: #e74c3c !important;
            font-weight: 500;
        }
        
        .dropdown-divider {
            margin: 0.5rem 0;
            border-color: rgba(0,0,0,0.1);
        }
        
        .navbar-toggler {
            border: none;
            padding: 0.5rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .navbar-toggler:focus {
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        }
        
        .navbar-toggler:hover {
            background: rgba(52, 152, 219, 0.1);
        }
        
        /* Responsive adjustments */
        @media (max-width: 991.98px) {
            .navbar-nav {
                padding: 1rem 0;
            }
            
            .nav-link {
                margin: 0.25rem 0;
                padding: 0.75rem 1rem !important;
            }
            
            .dropdown-menu {
                border: none;
                box-shadow: none;
                background: rgba(52, 152, 219, 0.05);
            }
        }
        
        /* Animation for navbar */
        .navbar {
            animation: slideDown 0.5s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>


    <div class="container mt-5">
        <!-- Modern Navigation Bar -->
        <nav class="navbar navbar-expand-lg navbar-light bg-white rounded-3 shadow-sm mb-4" style="border: 1px solid rgba(0,0,0,0.1);">
            <div class="container-fluid">
                <!-- Brand -->
                <a class="navbar-brand fw-bold text-primary" href="/">
                    <i class="fas fa-store me-2"></i>
                    Office Dress Shop
                </a>

                <!-- Mobile Toggle -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Navigation Links -->
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="/">
                                <i class="fas fa-home me-1"></i>
                                Trang chủ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/officedresses">
                                <i class="fas fa-tshirt me-1"></i>
                                Sản phẩm
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/cart-items">
                                <i class="fas fa-shopping-cart me-1"></i>
                                Giỏ hàng
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/orders">
                                <i class="fas fa-receipt me-1"></i>
                                Đơn hàng
                            </a>
                        </li>
                        <li class="nav-item" th:if="${role != null and (role == 'ADMIN' or role.toString() == 'ADMIN')}">
                            <a class="nav-link text-warning fw-bold" href="/admin/categories">
                                <i class="fas fa-cogs me-1"></i>
                                Quản trị
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-warning fw-bold" href="/auth/logout">
                                <i class="fas fa-cogs me-1"></i>
                                Đăng xuất
                            </a>
                        </li>
                    </ul>

                    <!-- User Menu -->
                    <div class="navbar-nav">
                        <div class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-user-circle me-2 text-primary"></i>
                                <span th:text="${email != null ? email : 'Khách'}">User</span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                                <li>
                                    <a class="dropdown-item" href="/profile">
                                        <i class="fas fa-user me-2"></i>
                                        Hồ sơ cá nhân
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="/orders">
                                        <i class="fas fa-history me-2"></i>
                                        Lịch sử đơn hàng
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item text-danger" href="/auth/logout" style="color: #e74c3c !important; font-weight: 500;">
                                        <i class="fas fa-sign-out-alt me-2"></i>
                                        Đăng xuất
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <section class="search-section">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-0">
                    <i class="fas fa-search me-2"></i>
                    Tìm kiếm sản phẩm
                </h2>
                <a href="/officedresses" class="btn btn-outline-primary">
                    <i class="fas fa-th-large me-2"></i>
                    Xem tất cả sản phẩm
                </a>
            </div>
            <form th:action="@{/}" method="get" class="search-form">
                <input type="text"
                       class="search-input"
                       name="search"
                       th:value="${searchTerm}"
                       placeholder="Nhập tên sản phẩm bạn muốn tìm...">
                <button type="submit" class="search-btn">
                    <i class="fas fa-search me-2"></i>
                    Tìm kiếm
                </button>
            </form>

            <div class="mt-3" th:if="${searchTerm != null and !searchTerm.isEmpty()}">
                <p class="text-muted mb-0">
                    <i class="fas fa-info-circle me-1"></i>
                    Kết quả tìm kiếm cho: "<strong th:text="${searchTerm}"></strong>"
                    - Tìm thấy <strong th:text="${totalItems}"></strong> sản phẩm
                </p>
            </div>
        </section>

        <section class="products-section">
            <div th:if="${dresses.isEmpty()}" class="empty-state">
                <i class="fas fa-search"></i>
                <h3>Không tìm thấy sản phẩm</h3>
                <p th:if="${searchTerm != null and !searchTerm.isEmpty()}">
                    Không có sản phẩm nào phù hợp với từ khóa "<strong th:text="${searchTerm}"></strong>"
                </p>
                <p th:unless="${searchTerm != null and !searchTerm.isEmpty()}">
                    Hiện tại chưa có sản phẩm nào trong cửa hàng
                </p>
                <a th:href="@{/}" class="btn-primary mt-3" style="display: inline-block; text-decoration: none;">
                    <i class="fas fa-home me-2"></i>
                    Về trang chủ
                </a>
            </div>

            <div class="products-grid fade-in" th:unless="${dresses.isEmpty()}">
                <div class="product-card" th:each="dress : ${dresses}">
                    <div class="product-image">
                        <img th:if="${dress.imageUrl}"
                             th:src="${dress.imageUrl}"
                             th:alt="${dress.description}"
                             loading="lazy"
                             style="opacity: 0;">
                        <img th:unless="${dress.imageUrl}"
                             src="/images/placeholder.svg"
                             alt="Placeholder"
                             loading="lazy"
                             style="opacity: 1;">


                        <div class="product-badge"
                             th:classappend="${dress.quantity > 0 ? 'in-stock' : 'out-of-stock'}">
                            <span th:if="${dress.quantity > 0}">Còn hàng</span>
                            <span th:unless="${dress.quantity > 0}">Hết hàng</span>
                        </div>
                    </div>

                    <div class="product-info">
                        <h3 class="product-title" th:text="${dress.description}">Tên sản phẩm</h3>

                        <div class="product-price">
                            <span th:text="${#numbers.formatDecimal(dress.basePrice, 0, 'COMMA', 0, 'POINT')}">0</span>
                            <span class="currency">₫</span>
                        </div>

                        <div class="product-actions">
                            <a th:href="@{/officedresses/{id}(id=${dress.id})}"
                               class="btn-primary"
                               data-loading>
                                <i class="fas fa-eye me-2"></i>
                                Xem chi tiết
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="pagination-wrapper" th:if="${totalPages > 1}">
            <nav class="pagination">
                <a class="page-link"
                   th:classappend="${currentPage == 0 ? 'disabled' : ''}"
                   th:href="@{/(page=${currentPage - 1}, search=${searchTerm})}">
                    <i class="fas fa-chevron-left me-1"></i>
                    Trước
                </a>

                <a class="page-link"
                   th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                   th:classappend="${currentPage == i ? 'active' : ''}"
                   th:href="@{/(page=${i}, search=${searchTerm})}"
                   th:text="${i + 1}">1</a>

                <a class="page-link"
                   th:classappend="${currentPage == totalPages - 1 ? 'disabled' : ''}"
                   th:href="@{/(page=${currentPage + 1}, search=${searchTerm})}">
                    Sau
                    <i class="fas fa-chevron-right ms-1"></i>
                </a>
            </nav>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script th:src="@{/js/user-app.js}"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('welcome') === 'true') {
                setTimeout(() => {
                    window.showToast('Chào mừng bạn đến với Office Dress Shop!', 'success', 5000);
                }, 1000);
            }

            document.querySelectorAll('.product-card').forEach(card => {
                card.addEventListener('click', function(e) {
                    if (!e.target.closest('.btn-primary')) {
                        const link = this.querySelector('.btn-primary');
                        if (link) {
                            window.location.href = link.href;
                        }
                    }
                });
            });

            document.querySelectorAll('.page-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    if (!this.classList.contains('disabled')) {
                        this.innerHTML = '<span class="loading"></span>';

                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                });
            });

            const searchForm = document.querySelector('.search-form');
            const searchInput = document.querySelector('.search-input');

            if (searchForm && searchInput) {
                searchForm.addEventListener('submit', function() {
                    const query = searchInput.value.trim();
                    if (query) {
                        let searchHistory = JSON.parse(localStorage.getItem('searchHistory') || '[]');
                        if (!searchHistory.includes(query)) {
                            searchHistory.unshift(query);
                            searchHistory = searchHistory.slice(0, 5);
                            localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
                        }
                    }
                });

                const suggestionsDiv = document.createElement('div');
                suggestionsDiv.className = 'search-suggestions';
                suggestionsDiv.style.cssText = `
                    position: absolute;
                    top: 100%;
                    left: 0;
                    right: 0;
                    background: white;
                    border: 1px solid #ddd;
                    border-top: none;
                    border-radius: 0 0 8px 8px;
                    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                    z-index: 1000;
                    display: none;
                `;

                searchInput.parentNode.style.position = 'relative';
                searchInput.parentNode.appendChild(suggestionsDiv);

                searchInput.addEventListener('focus', function() {
                    const searchHistory = JSON.parse(localStorage.getItem('searchHistory') || '[]');
                    if (searchHistory.length > 0) {
                        suggestionsDiv.innerHTML = searchHistory.map(term =>
                            `<div class="suggestion-item" style="padding: 0.5rem 1rem; cursor: pointer; border-bottom: 1px solid #eee;">
                                <i class="fas fa-history me-2 text-muted"></i>${term}
                            </div>`
                        ).join('');
                        suggestionsDiv.style.display = 'block';

                        suggestionsDiv.querySelectorAll('.suggestion-item').forEach(item => {
                            item.addEventListener('click', function() {
                                searchInput.value = this.textContent.trim();
                                suggestionsDiv.style.display = 'none';
                                searchForm.submit();
                            });
                        });
                    }
                });

                document.addEventListener('click', function(e) {
                    if (!searchInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                        suggestionsDiv.style.display = 'none';
                    }
                });
            }

            document.addEventListener('keydown', function(e) {
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    if (searchInput) {
                        searchInput.focus();
                        searchInput.select();
                    }
                }
            });
        });
    </script>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Ensure dropdown works -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Bootstrap dropdowns
            var dropdownElementList = [].slice.call(document.querySelectorAll('.dropdown-toggle'));
            var dropdownList = dropdownElementList.map(function (dropdownToggleEl) {
                return new bootstrap.Dropdown(dropdownToggleEl);
            });
            
            // Debug: Check if logout button exists
            const logoutButton = document.querySelector('.dropdown-item.text-danger');
            if (logoutButton) {
                console.log('Logout button found:', logoutButton.textContent.trim());
            } else {
                console.log('Logout button not found');
            }
        });
    </script>
</body>
</html>